# 📄 要件定義書 v1.1

## 1. 背景・目的

- **背景**  
    既存 Tkinter 版《壁打ちテニス》は単調でリテンションが低い。2025 年現在は **Pygame-CE が Pyodide/WASM で動く**ため、ブラウザ即プレイに移行可能となった。
    
- **目的**
    
    1. ブラウザ一発起動でユーザ獲得を最大化
        
    2. AI アダプティブ難易度・ソーシャル要素で継続率↑
        
    3. WCAG 2.2 AA 水準のアクセシビリティで潜在層を取り込む
        

## 2. スコープ

|含む|含まない|
|---|---|
|ゲームロジック刷新 / PWA 化 / オンラインランキング|VR 対応、マルチプレイ同期、課金要素|

## 3. 用語

|略語|定義|
|---|---|
|**ADA**|AI Dynamic Adjustment：ミス率に応じた難易度自動調整|
|**PCG**|Procedural Content Generation：シード値からステージ自動生成|
|**PWA**|Progressive Web App：ホーム画面追加・オフライン対応|

## 4. ユーザペルソナ（要約）

|ペルソナ|ニーズ|
|---|---|
|🎮 ライト層|3 分で遊びたい／SNS 共有したい|
|🏆 ガチ勢|高速ラリー＆ランキング上位を狙う|
|♿ アクセシビリティ重視|片手操作・カラーブラインド・高コントラスト|

## 5. システム構成

```text
┌────────────┐         ┌───────────────────────┐
│  Browser    │ WASM    │  /public/index.html    │  ← ゲーム本体
│  (user)     │◀──────▶│  Pyodide + Pygame-CE   │
└────────────┘         └────────┬──────────────┘
                                  │ fetch (HTTPS)
                                  ▼
                         ┌────────────────────────┐
                         │  /api/leaderboard.py   │  ← Vercel Python Function
                         └────────┬───────────────┘
                                  │ SQLite / KV
                                  ▼
                         ┌────────────────────────┐
                         │  score.db / Edge KV    │
                         └────────────────────────┘
```

> Vercel Functions は **解凍後 250 MB 制限**があるため、依存は軽量に保つ。

## 6. 機能要件（FR）

|ID|要件|主要仕様|
|---|---|---|
|FR-01|コアゲームループ|Pygame-CE 60 fps / ラケット・ボール物理|
|FR-02|ADA 難易度|`miss_ratio` に応じ速度± / 角度乱数|
|FR-03|パワーアップ|分裂・巨大化・スロー etc. 5〜10 s|
|FR-04|PCG ステージ|障害物・壁配置をシード生成|
|FR-05|BGM / SE|8-bit ループ BGM + ピッチ変調 SE|
|FR-06|オンラインランキング|TOP100 GET/POST JSON|
|FR-07|週替わりチャレンジ|毎週 Mon 00:00 JST に server-seed 更新|
|FR-08|アクセシビリティ|色覚 3 モード・高コントラスト・片手＆キー操作|
|FR-09|マルチプラットフォーム|Windows / macOS / Linux / Web (WASM)|

## 7. 非機能要件（NFR）

|分類|要件|
|---|---|
|性能|60 fps、入力遅延 ≤ 80 ms|
|セキュリティ|OWASP Top-10 準拠、API key を Vercel 環境変数管理|
|可用性|API 障害時はローカルキャッシュ後送信|
|アクセシビリティ|WCAG 2.2 AA 準拠|

## 8. 制約

- Python 3.12 + Pygame-CE 2.5
    
- Pyodide CLI 0.28 以降 (`pyodide build --outdir public`)
    
- Vercel Build Output API v3 を使用
    

## 9. 受け入れ基準（抜粋）

|テスト|合格条件|
|---|---|
|ADA 挙動|ミス率 > 30 % → 速度 −20 %、< 10 % → ＋15 %|
|色覚対応|RG/BY/BG 各シミュレーターでボール視認可|
|週替わり|同一 seed 週は全ユーザ同一マップ|

---
