<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <title>ã‚¦ã‚£ãƒ¼ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .status {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .success {
            color: #4CAF50;
        }
        
        .error {
            color: #dc3545;
        }
        
        .info {
            color: #17a2b8;
        }
        
        .progress-display {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #555;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }
        
        .challenge-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .info-item {
            background: #444;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        
        .info-label {
            font-size: 12px;
            color: #ccc;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ† ã‚¦ã‚£ãƒ¼ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>1. Pyodideç’°å¢ƒãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testPyodideEnvironment()">Pyodideã®èª­ã¿è¾¼ã¿ç¢ºèª</button>
        <div id="pyodide-status" class="status"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Pythonã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="loadGameEngine()">ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã‚’èª­ã¿è¾¼ã¿</button>
        <button onclick="testGameState()" disabled id="test-game-state-btn">game_stateã‚’ãƒ†ã‚¹ãƒˆ</button>
        <div id="game-engine-status" class="status"></div>
    </div>
    
    <div class="test-section">
        <h2>3. ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="enableChallengeMode()" disabled id="enable-challenge-btn">ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–</button>
        <button onclick="simulateGameplay()" disabled id="simulate-gameplay-btn">ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <button onclick="disableChallengeMode()" disabled id="disable-challenge-btn">ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–</button>
        <div id="challenge-status" class="status"></div>
    </div>
    
    <div class="test-section">
        <h2>4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—è¡¨ç¤º</h2>
        <div class="progress-display" id="progress-display" style="display: none;">
            <h3>ç¾åœ¨ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
            <div id="challenge-title">ã‚¹ã‚³ã‚¢ãƒãƒ£ãƒ¬ãƒ³ã‚¸</div>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="progress-text">0 / 1000</div>
            
            <div class="challenge-info">
                <div class="info-item">
                    <div class="info-label">ç¾åœ¨ã‚¹ã‚³ã‚¢</div>
                    <div id="current-score" class="info-value">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">é€£ç¶šãƒ’ãƒƒãƒˆ</div>
                    <div id="consecutive-hits" class="info-value">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">çµŒéæ™‚é–“</div>
                    <div id="elapsed-time" class="info-value">0s</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                    <div id="challenge-status-value" class="info-value">é€²è¡Œä¸­</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>5. JavaScript-Pythonãƒ–ãƒªãƒƒã‚¸ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testBridgeCommunication()" disabled id="test-bridge-btn">ãƒ–ãƒªãƒƒã‚¸é€šä¿¡ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <div id="bridge-status" class="status"></div>
    </div>

    <!-- Pyodideã®èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    
    <script>
        let pyodide = null;
        let gameEngineLoaded = false;
        let challengeActive = false;
        let progressUpdateInterval = null;

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é–¢æ•°
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        // Pyodideç’°å¢ƒãƒ†ã‚¹ãƒˆ
        async function testPyodideEnvironment() {
            try {
                updateStatus('pyodide-status', 'Pyodideã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
                
                if (!pyodide) {
                    pyodide = await loadPyodide();
                }
                
                // PythonåŸºæœ¬å‹•ä½œãƒ†ã‚¹ãƒˆ
                pyodide.runPython(`
                    import sys
                    print(f"Python version: {sys.version}")
                    print("Pyodide environment ready!")
                `);
                
                updateStatus('pyodide-status', 'Pyodideç’°å¢ƒã®èª­ã¿è¾¼ã¿æˆåŠŸâœ“', 'success');
                
                // æ¬¡ã®ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                document.getElementById('test-game-state-btn').disabled = false;
                
            } catch (error) {
                updateStatus('pyodide-status', `Pyodideèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        async function loadGameEngine() {
            try {
                updateStatus('game-engine-status', 'ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
                
                if (!pyodide) {
                    updateStatus('game-engine-status', 'PyodideãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                    return;
                }
                
                // Pythonã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿
                await pyodide.loadPackage(['tkinter']);
                
                // ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿ï¼ˆã“ã“ã§ã¯ç°¡ç•¥åŒ–ï¼‰
                pyodide.runPython(`
                    import json
                    from datetime import datetime
                    
                    # ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã®ç°¡ç•¥ç‰ˆï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
                    class TestGameEngine:
                        def __init__(self):
                            self.challenge_mode = False
                            self.challenge_data = None
                            self.point = 0
                            self.combo = 0
                            self.consecutive_hits = 0
                            self.max_consecutive_hits = 0
                            self.total_hits = 0
                            self.misses = 0
                            self.is_gameover = False
                            self.game_start_time = None
                            self.special_actions_performed = []
                            
                        def set_challenge_mode(self, challenge_data):
                            self.challenge_mode = True
                            self.challenge_data = challenge_data
                            self.game_start_time = datetime.now()
                            print(f"Challenge mode enabled: {challenge_data}")
                            
                        def disable_challenge_mode(self):
                            self.challenge_mode = False
                            self.challenge_data = None
                            print("Challenge mode disabled")
                            
                        def get_challenge_progress_data(self):
                            if not self.challenge_mode or not self.challenge_data:
                                return None
                                
                            elapsed_time = (datetime.now() - self.game_start_time).total_seconds() if self.game_start_time else 0
                            challenge_type = self.challenge_data.get('type', '')
                            target = self.challenge_data.get('target', 0)
                            
                            progress_data = {
                                'type': challenge_type,
                                'target': target,
                                'current': self.point if challenge_type == 'score' else self.max_consecutive_hits,
                                'elapsed_time': elapsed_time,
                                'time_limit': self.challenge_data.get('timeLimit', 120),
                                'completed': False,
                                'failed': False
                            }
                            
                            if challenge_type == 'score':
                                progress_data['current'] = self.point
                                progress_data['completed'] = self.point >= target
                            elif challenge_type == 'consecutive_hits':
                                progress_data['current'] = self.max_consecutive_hits
                                progress_data['completed'] = self.max_consecutive_hits >= target
                                
                            return progress_data
                            
                        def simulate_hit(self):
                            """ãƒ’ãƒƒãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
                            self.combo += 1
                            self.point += 10 * (1 + self.combo // 5)
                            self.consecutive_hits += 1
                            self.total_hits += 1
                            self.max_consecutive_hits = max(self.max_consecutive_hits, self.consecutive_hits)
                            
                        def simulate_miss(self):
                            """ãƒŸã‚¹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
                            self.combo = 0
                            self.consecutive_hits = 0
                            self.misses += 1
                    
                    # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
                    class GameState:
                        def __init__(self):
                            self.game_engine = None
                            self.challenge_mode = False
                            self.challenge_data = None
                            
                        def set_game_engine(self, engine):
                            self.game_engine = engine
                            
                        def enable_challenge_mode(self, challenge_data_json):
                            try:
                                if isinstance(challenge_data_json, str):
                                    challenge_data = json.loads(challenge_data_json)
                                else:
                                    challenge_data = challenge_data_json
                                    
                                self.challenge_mode = True
                                self.challenge_data = challenge_data
                                
                                if self.game_engine:
                                    self.game_engine.set_challenge_mode(challenge_data)
                                    
                                return True
                            except Exception as e:
                                print(f"Error enabling challenge mode: {e}")
                                return False
                                
                        def get_challenge_progress(self):
                            if self.game_engine and self.challenge_mode:
                                progress = self.game_engine.get_challenge_progress_data()
                                return json.dumps(progress) if progress else None
                            return None
                    
                    # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
                    test_game = TestGameEngine()
                    game_state = GameState()
                    game_state.set_game_engine(test_game)
                    
                    print("Game engine loaded successfully!")
                `);
                
                gameEngineLoaded = true;
                updateStatus('game-engine-status', 'ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿æˆåŠŸâœ“', 'success');
                
                // æ¬¡ã®ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                document.getElementById('enable-challenge-btn').disabled = false;
                document.getElementById('test-bridge-btn').disabled = false;
                
            } catch (error) {
                updateStatus('game-engine-status', `ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // game_stateãƒ†ã‚¹ãƒˆ
        async function testGameState() {
            try {
                if (!gameEngineLoaded) {
                    await loadGameEngine();
                }
                
                // game_stateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å­˜åœ¨ç¢ºèª
                const result = pyodide.runPython(`
                    hasattr(game_state, 'game_engine') and game_state.game_engine is not None
                `);
                
                if (result) {
                    updateStatus('game-engine-status', 'game_state ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¢ºèªæˆåŠŸâœ“', 'success');
                } else {
                    updateStatus('game-engine-status', 'game_state ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                updateStatus('game-engine-status', `game_stateãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–ãƒ†ã‚¹ãƒˆ
        async function enableChallengeMode() {
            try {
                updateStatus('challenge-status', 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–ä¸­...', 'info');
                
                // ãƒ†ã‚¹ãƒˆç”¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ‡ãƒ¼ã‚¿
                const challengeData = {
                    type: 'score',
                    target: 1000,
                    timeLimit: 120,
                    title: 'ã‚¹ã‚³ã‚¢ãƒã‚¹ã‚¿ãƒ¼',
                    description: '1000ç‚¹ä»¥ä¸Šã®ã‚¹ã‚³ã‚¢ã‚’ç²å¾—ã—ã¦ãã ã•ã„'
                };
                
                // Pythonã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–
                const success = pyodide.runPython(`
                    import json
                    challenge_data = json.loads('${JSON.stringify(challengeData)}')
                    game_state.enable_challenge_mode(challenge_data)
                `);
                
                if (success) {
                    challengeActive = true;
                    updateStatus('challenge-status', 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–æˆåŠŸâœ“', 'success');
                    
                    // é€²æ—è¡¨ç¤ºã‚’é–‹å§‹
                    document.getElementById('progress-display').style.display = 'block';
                    document.getElementById('simulate-gameplay-btn').disabled = false;
                    document.getElementById('disable-challenge-btn').disabled = false;
                    
                    // é€²æ—æ›´æ–°ã‚’é–‹å§‹
                    startProgressUpdates();
                } else {
                    updateStatus('challenge-status', 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–å¤±æ•—', 'error');
                }
                
            } catch (error) {
                updateStatus('challenge-status', `ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        async function simulateGameplay() {
            if (!challengeActive) return;
            
            try {
                // ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ’ãƒƒãƒˆã¾ãŸã¯ãƒŸã‚¹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                const isHit = Math.random() > 0.3; // 70%ã®ç¢ºç‡ã§ãƒ’ãƒƒãƒˆ
                
                if (isHit) {
                    pyodide.runPython('test_game.simulate_hit()');
                    updateStatus('challenge-status', 'âœ“ ãƒ’ãƒƒãƒˆ!', 'success');
                } else {
                    pyodide.runPython('test_game.simulate_miss()');
                    updateStatus('challenge-status', 'âœ— ãƒŸã‚¹', 'error');
                }
                
            } catch (error) {
                updateStatus('challenge-status', `ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ç„¡åŠ¹åŒ–
        async function disableChallengeMode() {
            try {
                pyodide.runPython('game_state.game_engine.disable_challenge_mode()');
                
                challengeActive = false;
                updateStatus('challenge-status', 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰ç„¡åŠ¹åŒ–å®Œäº†', 'info');
                
                // é€²æ—è¡¨ç¤ºã‚’éš ã™
                document.getElementById('progress-display').style.display = 'none';
                document.getElementById('simulate-gameplay-btn').disabled = true;
                document.getElementById('disable-challenge-btn').disabled = true;
                
                // é€²æ—æ›´æ–°ã‚’åœæ­¢
                if (progressUpdateInterval) {
                    clearInterval(progressUpdateInterval);
                    progressUpdateInterval = null;
                }
                
            } catch (error) {
                updateStatus('challenge-status', `ç„¡åŠ¹åŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // é€²æ—æ›´æ–°ã‚’é–‹å§‹
        function startProgressUpdates() {
            if (progressUpdateInterval) {
                clearInterval(progressUpdateInterval);
            }
            
            progressUpdateInterval = setInterval(updateChallengeProgress, 500);
        }

        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸é€²æ—ã‚’æ›´æ–°ï¼ˆJavaScriptã®updateChallengeProgressé–¢æ•°ï¼‰
        function updateChallengeProgress(gameDataJson) {
            try {
                let gameData;
                
                if (typeof gameDataJson === 'string') {
                    gameData = JSON.parse(gameDataJson);
                } else {
                    // æ‰‹å‹•ã§é€²æ—ã‚’å–å¾—
                    const progressJson = pyodide.runPython('game_state.get_challenge_progress()');
                    if (!progressJson) return;
                    
                    const progress = JSON.parse(progressJson);
                    const score = pyodide.runPython('test_game.point');
                    const consecutiveHits = pyodide.runPython('test_game.consecutive_hits');
                    
                    gameData = {
                        score: score,
                        consecutive_hits: consecutiveHits,
                        challenge_progress: progress
                    };
                }
                
                const progress = gameData.challenge_progress;
                if (!progress) return;
                
                // UIæ›´æ–°
                document.getElementById('current-score').textContent = gameData.score || 0;
                document.getElementById('consecutive-hits').textContent = gameData.consecutive_hits || 0;
                document.getElementById('elapsed-time').textContent = Math.floor(progress.elapsed_time || 0) + 's';
                
                // é€²æ—ãƒãƒ¼æ›´æ–°
                const progressPercent = Math.min((progress.current / progress.target) * 100, 100);
                document.getElementById('progress-fill').style.width = progressPercent + '%';
                document.getElementById('progress-text').textContent = `${progress.current} / ${progress.target}`;
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                let status = 'é€²è¡Œä¸­';
                if (progress.completed) {
                    status = 'å®Œäº†ï¼';
                    document.getElementById('challenge-status-value').style.color = '#4CAF50';
                } else if (progress.failed) {
                    status = 'å¤±æ•—';
                    document.getElementById('challenge-status-value').style.color = '#dc3545';
                } else {
                    document.getElementById('challenge-status-value').style.color = '#17a2b8';
                }
                document.getElementById('challenge-status-value').textContent = status;
                
            } catch (error) {
                console.error('Progress update error:', error);
            }
        }

        // ãƒ–ãƒªãƒƒã‚¸é€šä¿¡ãƒ†ã‚¹ãƒˆ
        async function testBridgeCommunication() {
            try {
                updateStatus('bridge-status', 'ãƒ–ãƒªãƒƒã‚¸é€šä¿¡ã‚’ãƒ†ã‚¹ãƒˆä¸­...', 'info');
                
                // Pythoné–¢æ•°ã‚’JavaScriptã‹ã‚‰å‘¼ã³å‡ºã—
                const result = pyodide.runPython(`
                    # ãƒ†ã‚¹ãƒˆé–¢æ•°
                    def test_bridge_function(message):
                        return f"Python received: {message}"
                    
                    test_bridge_function("Hello from JavaScript!")
                `);
                
                updateStatus('bridge-status', `ãƒ–ãƒªãƒƒã‚¸é€šä¿¡æˆåŠŸâœ“\\nPythonã‹ã‚‰ã®å¿œç­”: ${result}`, 'success');
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‚’è¨­å®šã—ã¦Pythonã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹
                window.testJSFunction = function(message) {
                    updateStatus('bridge-status', `JavaScripté–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ: ${message}`, 'success');
                };
                
                // Pythonã‹ã‚‰ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‚’å‘¼ã³å‡ºã—
                pyodide.runPython(`
                    import js
                    if hasattr(js, 'testJSFunction'):
                        js.testJSFunction("Hello from Python!")
                    else:
                        print("testJSFunction not found")
                `);
                
            } catch (error) {
                updateStatus('bridge-status', `ãƒ–ãƒªãƒƒã‚¸é€šä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', () => {
            updateStatus('pyodide-status', 'ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†ã€‚Pyodideãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚', 'info');
        });
    </script>
</body>
</html>