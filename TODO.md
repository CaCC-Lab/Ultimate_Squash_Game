# Ultimate Squash Game - 実装計画

作成日: 2025-01-13
最終更新: 2025-01-13
担当者: Claude Code + Gemini CLI [AI-PAIRED]

## 概要
AIパワーアップ機能を搭載したクラシックなスカッシュゲームの段階的開発
個人開発規約に従ったTDD実践とAI統合を実現

## 前提条件
- [x] プロジェクト構成ファイルの確認 → 不在確認済み
- [ ] 必要な権限の確認
- [ ] 技術的な前提条件の確認（Python 3.8+, Ollama）

## 実装チェックリスト

### フェーズ1: プロジェクト基盤整備（見積もり: 2h）✅ 完了
- [x] プロジェクト構成ファイルの作成
  - [x] technologystack.md の作成
  - [x] directorystructure.md の作成  
  - [x] test-strategy.md の作成
- [x] ディレクトリ構造のリファクタリング
  - [x] src/ ディレクトリの作成
  - [x] 既存ファイルの適切な配置（game_engine.py → src/game/engine.py）
  - [x] tests/ ディレクトリの構築
- [x] 基本テスト環境の構築
  - [x] pytest のセットアップ
  - [x] 初期テストファイルの作成

### フェーズ1.5: engine.pyリファクタリング（見積もり: 3h）✅ 完了
- [x] 特性化テスト（Characterization Test）の作成
  - [x] 現在のengine.pyの動作を記録するテスト（11テスト成功）
  - [x] ゲーム状態変化のスナップショット保存
  - [x] UI表示内容の期待値記録
- [x] Model抽出（MVCパターン移行）
  - [x] GameStateクラスの作成（純粋データクラス）
  - [x] Ball, Racket, Scoreエンティティの分離（18テスト成功）
  - [x] 物理計算ロジックのModel移動
  - [x] Observerパターンの実装（Model→View通知）
- [x] View分離
  - [x] GameViewクラスの作成（描画専用）
  - [x] GameObserverインターフェースの実装
  - [x] tkinter描画処理の分離
  - [x] エラーハンドリング（3要素準拠）
- [x] Controller分離
  - [x] GameControllerクラスの作成（5テスト成功）
  - [x] イベント処理の分離（マウス、クリック、キー）
  - [x] Model-View連携の実装（Observerパターン管理）
  - [x] ゲームループ制御の実装

### フェーズ2: コアゲームのTDD実装（見積もり: 4h）
- [ ] ユニットテストの作成（TDD実践）
  - [ ] 分離されたGameStateのテスト
    - [ ] ボール物理演算のテスト
    - [ ] 衝突検出のテスト
    - [ ] スコア計算のテスト
  - [ ] UIコンポーネントのテスト
    - [ ] GameViewのテスト
    - [ ] Controller入力処理のテスト
- [ ] 実装
  - [ ] TDD手法での新機能追加
  - [ ] パフォーマンス最適化
- [ ] 統合テスト
  - [ ] ゲーム全体動作確認
  - [ ] リファクタリング後の動作検証

### フェーズ3: AI接続機能（見積もり: 3h）
- [ ] AIクライアントのテスト作成（TDD）
  - [ ] Ollama接続テスト（実環境）
  - [ ] モデル応答テスト
  - [ ] エラーハンドリングテスト（3要素準拠）
- [ ] AI機能の実装
  - [ ] src/ai/client.py の実装
  - [ ] 接続管理とタイムアウト処理
  - [ ] エラーメッセージの3要素対応

### フェーズ4: AI統合とエンハンサー（見積もり: 4h）
- [ ] AI統合テストの作成
  - [ ] ゲーム状態からAI応答への変換テスト
  - [ ] AIによるゲーム制御テスト
- [ ] AI統合実装
  - [ ] src/ai/enhancer.py の実装
  - [ ] Observer パターンでの統合
  - [ ] 非同期処理の実装

### フェーズ5: 最終品質確認（見積もり: 2h）
- [ ] 全体テストの実行
  - [ ] ユニットテスト: 80%以上カバレッジ
  - [ ] 統合テスト: 全シナリオ成功
  - [ ] E2Eテスト: 手動チェックリスト
- [ ] エラーハンドリングの確認
  - [ ] 3要素エラーメッセージの検証
  - [ ] 例外処理の網羅性確認
- [ ] ドキュメント更新
  - [ ] CLAUDE.md の更新
  - [ ] README.md の更新

## 進捗メモ

### 2025-01-13 14:00
- プロジェクト構成ファイル不在を確認
- Gemini CLIと連携してプロジェクト計画を策定
- 個人開発規約に準拠した実装方針を決定
- TODO.md作成完了

### 2025-01-13 15:30
- フェーズ1完了: プロジェクト基盤整備
- ディレクトリ構造リファクタリング完了（MVC分離）
- pytest環境構築（3つの基本テスト成功）
- ゲーム起動確認（新構造で正常動作）
- 技術スタック調整（Python 3.6環境対応）

### 2025-01-13 17:45
- フェーズ1.5完了: engine.pyリファクタリング（MVCパターン移行）
- 特性化テスト: 11テスト成功（元の動作を記録）
- GameStateクラス: 18テスト成功（純粋なModel層）
- GameViewクラス: Observerパターン実装（UI描画分離）
- GameControllerクラス: 5テスト成功（イベント処理・協調管理）
- リファクタリング検証: 既存29テスト全成功（デグレードなし）
- MVCパターン完成: Model-View-Controller分離達成

## 課題・リスク

### 技術的課題
- [ ] tkinter UIの自動テスト方法の検討
  - 影響度：中
  - 対応策：手動E2Eテストリストで補完
- [ ] Ollama実環境テストの依存関係
  - 影響度：高
  - 対応策：テスト用Ollamaサーバーの常時稼働確認

### スケジュールリスク
- [ ] AI統合の複雑性
  - 発生確率：中
  - 対応策：段階的統合とフォールバック実装

## 学んだこと・改善点

- 個人開発規約の厳格な遵守により、プロジェクト品質向上
- TDD実践によるコード信頼性確保
- AI連携パターンの活用による開発効率化

## 完了条件

- [ ] すべての実装チェックリストが完了
- [ ] テストカバレッジ80%以上
- [ ] AI機能統合動作確認
- [ ] 個人開発規約遵守の最終確認